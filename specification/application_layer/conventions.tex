\section{Application-level conventions}\label{sec:application_level_conventions}

\subsection{Identifier distribution}

An overview of related concepts is provided in chapter \ref{sec:basic_concepts}.

\subsubsection{Node ID}

Valid values of node ID range from 0 to 127, inclusive.

The node ID values 126 and 127 are reserved for diagnostic and debugging tools;
these node ID values should not be used in fielded systems.

\subsubsection{Port ID}

The subject and service identifier values are segregated into three ranges:
unregulated port identifiers that can be freely chosen by users and integrators (both fixed and non-fixed);
regulated fixed identifiers for non-standard data type definitions
that are assigned by the UAVCAN maintainers for publicly released data types;
and regulated identifiers of the standard data types that are an integral part of the UAVCAN specification.

More information on the subject of data type regulation is provided in section
\ref{sec:basic_concepts_data_type_regulation}.

The ranges are summarized in the table \ref{table:application_port_id_distribution}.
Unused gaps are reserved for future expansion of adjacent ranges.

\begin{UAVCANSimpleTable}{Port identifier distribution}{|l l X|}\label{table:application_port_id_distribution}
    Subject ID          & Service ID        & Purpose \\
    $[0, 32767]$        & $[0, 127]$        & Unregulated identifiers (both fixed and non-fixed). \\
    $[57344, 59391]$    & $[256, 319]$      & Non-standard regulated identifiers (i.e., vendor-specific). \\
    $[62804, 65535]$    & $[384, 511]$      & Standard regulated identifiers. \\
\end{UAVCANSimpleTable}

\subsection{Coordinate frames}

UAVCAN follows the conventions that are widely accepted in relevant applications.
Adherence to the conventions described here maximizes system compatibility and reduces the amount of
computations for conversions between incompatible coordinate systems and representations.
It is recognized, however, that some applications may find the advised conventions unsuitable,
in which case deviations are permitted.
Any such deviations must be explicitly documented.

All coordinate systems defined in this section are right handed.
If application-specific coordinate systems are introduced, they should be right handed as well.

\begin{figure}[hbt]
    \centering
    % The source image is released under CC0, public domain, no attribution required:
    % https://commons.wikimedia.org/wiki/File:ECEF_ENU_Longitude_Latitude_relationships.svg
	\includegraphics[width=0.45\textwidth]{application_layer/NED_ECEF}
    % The source image is released under CC0, public domain, no attribution required:
    % https://pixabay.com/en/airplane-plane-aircraft-propeller-40374/
    % The final image is drawn by me. The source Inkscape SVG file is located in the same directory.
    \includegraphics[width=0.45\textwidth]{application_layer/aircraft_principal_axes}
    North-East-Down (NED) frame and body frame conventions. All systems are right handed.
    \caption{
        Coordinate frame conventions.
        \label{fig:application_coordinate_frame_conventions}
    }
\end{figure}

\subsubsection{World frame}

For world fixed frames, the \emph{North-East-Down} (NED) right handed notation should be preferred.
\begin{samepage}
\begin{description}
    \item[X] --- northward;
    \item[Y] --- eastward;
    \item[Z] --- down.
\end{description}
\end{samepage}

\subsubsection{Body frame}

In relation to a body, the convention is as defined below, right handed.
This convention is widely used in aeronautic applications.
\begin{samepage}
\begin{description}
    \item[X] --- forward;
    \item[Y] --- right;
    \item[Z] --- down.
\end{description}
\end{samepage}

\subsubsection{Optical frame}

In the case of cameras, the right handed convention specified below should be preferred.
It is widely used in various applications involving computer vision systems.
\begin{samepage}
\begin{description}
    \item[X] --- right;
    \item[Y] --- down;
    \item[Z] --- towards the scene along the optical axis.
\end{description}
\end{samepage}

\subsection{Rotation representation}

All applications should represent rotations using quaternions with the elements ordered as follows\footnote{%
    Assuming $w + x\boldsymbol{i} + y\boldsymbol{j} + z\boldsymbol{k}$.
}: W, X, Y, Z.
Other forms of rotation representations should be avoided.

Angular velocities should be represented using a right handed fixed axis (extrinsic) convention:
X (roll), Y (pitch), Z (yaw).

\begin{remark}
    Quaternions are considered to offer an optimal trade-off between bandwidth efficiency,
    computation complexity, and explicitness.

    Rotation matrices are redundant and not bandwidth efficient.

    Euler angles are not self-contained, requiring applications to agree on a particular
    convention beforehand; such convention would be difficult to establish considering different
    demands of various use cases.

    Euler angles and fixed axis rotations typically cannot be used for computations directly due to angular
    interpolation issues and singularities; thus, in order to make use of such representations,
    one often has to convert them to a different form (e.g., quaternion); such conversions are
    typically computationally heavy.
\end{remark}

\subsection{Matrix representation}

\subsection{Physical quantity representation}
